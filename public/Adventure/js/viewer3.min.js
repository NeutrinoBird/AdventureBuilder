function validate(e,t){var i={form:{},error:!1,errorMsg:"",errorFields:[]};for(var n in t){switch(t[n].type=t[n].type||"uint",t[n].required=t[n].required||!1,t[n].maxLength=t[n].maxLength||0,null==e.selector?(t[n].value=e[t[n].name],"bit"==t[n].type&&1!=t[n].value&&(t[n].value=0)):(t[n].value=e.find(" [name='"+t[n].name+"']").val(),"checkbox"==e.find("[name='"+t[n].name+"']").attr("type")&&""==t[n].value&&(t[n].value=0)),t[n].required&&""==t[n].value&&(i.errorMsg+="<li>"+t[n].name+" is required.</li>",i.errorFields.push(t[n].name)),t[n].type){case"uint":$.isNumeric(t[n].value)||""==t[n].value?$.isNumeric(t[n].value)&&(t[n].value>4294967295?(i.errorMsg+="<li>"+t[n].name+" is too large.</li>",i.errorFields.push(t[n].name)):t[n].value<0&&(i.errorMsg+="<li>"+t[n].name+" is too low.</li>",i.errorFields.push(t[n].name))):(i.errorMsg+="<li>"+t[n].name+" is invalid.</li>",i.errorFields.push(t[n].name));break;case"int":$.isNumeric(t[n].value)||""==t[n].value?$.isNumeric(t[n].value)&&(t[n].value>2147483647?(i.errorMsg+="<li>"+t[n].name+" is too large.</li>",i.errorFields.push(t[n].name)):t[n].value<-2147483648&&(i.errorMsg+="<li>"+t[n].name+" is too low.</li>",i.errorFields.push(t[n].name))):(i.errorMsg+="<li>"+t[n].name+" is invalid.</li>",i.errorFields.push(t[n].name));break;case"tinyint":$.isNumeric(t[n].value)||""==t[n].value?$.isNumeric(t[n].value)&&(t[n].value>255?(i.errorMsg+="<li>"+t[n].name+" is too large.</li>",i.errorFields.push(t[n].name)):t[n].value<0&&(i.errorMsg+="<li>"+t[n].name+" is too low.</li>",i.errorFields.push(t[n].name))):(i.errorMsg+="<li>"+t[n].name+" is invalid.</li>",i.errorFields.push(t[n].name));break;case"bit":0!=t[n].value&&1!=t[n].value&&(i.errorMsg+="<li>"+t[n].name+" is invalid.</li>",i.errorFields.push(t[n].name));break;case"string":t[n].value.length>=t[n].maxLength&&(i.errorMsg+="<li>"+t[n].name+" must be "+t[n].maxLength+" characters or less. It is currently "+t[n].value.length+" characters long.</li>",i.errorFields.push(t[n].name));break;case"percent":t[n].value.length>=t[n].maxLength?(i.errorMsg+="<li>"+t[n].name+" must be "+t[n].maxLength+" characters or less. It is currently "+t[n].value.length+" characters long.</li>",i.errorFields.push(t[n].name)):-1==t[n].value.search(/^[0-9]+(\.[0-9]+)?%$/)&&(i.errorMsg+="<li>"+t[n].name+" is an invalid percentage.</li>",i.errorFields.push(t[n].name));break;case"decimal":t[n].value.length>=t[n].maxLength?(i.errorMsg+="<li>"+t[n].name+" must be "+t[n].maxLength+" characters or less. It is currently "+t[n].value.length+" characters long.</li>",i.errorFields.push(t[n].name)):-1==t[n].value.search(/^[0-9]+(\.[0-9]+)?$/)&&(i.errorMsg+="<li>"+t[n].name+" is an invalid decimal.</li>",i.errorFields.push(t[n].name))}i.form[t[n].name]=t[n].value}return i.error=""!=i.errorMsg,i}function int(e){return parseInt(e)||0}!function(e){var t="object"==typeof self&&self.self===self&&self||"object"==typeof global&&global.global===global&&global;if("function"==typeof define&&define.amd)define(["underscore","jquery","exports"],function(i,n,r){t.Backbone=e(t,r,i,n)});else if("undefined"!=typeof exports){var i,n=require("underscore");try{i=require("jquery")}catch(r){}e(t,exports,n,i)}else t.Backbone=e(t,{},t._,t.jQuery||t.Zepto||t.ender||t.$)}(function(e,t,i,n){var r=e.Backbone,s=Array.prototype.slice;t.VERSION="1.3.3",t.$=n,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var a=function(e,t,n){switch(e){case 1:return function(){return i[t](this[n])};case 2:return function(e){return i[t](this[n],e)};case 3:return function(e,r){return i[t](this[n],h(e,this),r)};case 4:return function(e,r,s){return i[t](this[n],h(e,this),r,s)};default:return function(){var e=s.call(arguments);return e.unshift(this[n]),i[t].apply(i,e)}}},o=function(e,t,n){i.each(t,function(t,r){i[r]&&(e.prototype[r]=a(t,r,n))})},h=function(e,t){return i.isFunction(e)?e:i.isObject(e)&&!t._isModel(e)?l(e):i.isString(e)?function(t){return t.get(e)}:e},l=function(e){var t=i.matches(e);return function(e){return t(e.attributes)}},d=t.Events={},u=/\s+/,c=function(e,t,n,r,s){var a,o=0;if(n&&"object"==typeof n){void 0!==r&&"context"in s&&void 0===s.context&&(s.context=r);for(a=i.keys(n);o<a.length;o++)t=c(e,t,a[o],n[a[o]],s)}else if(n&&u.test(n))for(a=n.split(u);o<a.length;o++)t=e(t,a[o],r,s);else t=e(t,n,r,s);return t};d.on=function(e,t,i){return g(this,e,t,i)};var g=function(e,t,i,n,r){if(e._events=c(f,e._events||{},t,i,{context:n,ctx:e,listening:r}),r){var s=e._listeners||(e._listeners={});s[r.id]=r}return e};d.listenTo=function(e,t,n){if(!e)return this;var r=e._listenId||(e._listenId=i.uniqueId("l")),s=this._listeningTo||(this._listeningTo={}),a=s[r];if(!a){var o=this._listenId||(this._listenId=i.uniqueId("l"));a=s[r]={obj:e,objId:r,id:o,listeningTo:s,count:0}}return g(e,t,n,this,a),this};var f=function(e,t,i,n){if(i){var r=e[t]||(e[t]=[]),s=n.context,a=n.ctx,o=n.listening;o&&o.count++,r.push({callback:i,context:s,ctx:s||a,listening:o})}return e};d.off=function(e,t,i){return this._events?(this._events=c(v,this._events,e,t,{context:i,listeners:this._listeners}),this):this},d.stopListening=function(e,t,n){var r=this._listeningTo;if(!r)return this;for(var s=e?[e._listenId]:i.keys(r),a=0;a<s.length;a++){var o=r[s[a]];if(!o)break;o.obj.off(t,n,this)}return this};var v=function(e,t,n,r){if(e){var s,a=0,o=r.context,h=r.listeners;if(t||n||o){for(var l=t?[t]:i.keys(e);a<l.length;a++){t=l[a];var d=e[t];if(!d)break;for(var u=[],c=0;c<d.length;c++){var g=d[c];n&&n!==g.callback&&n!==g.callback._callback||o&&o!==g.context?u.push(g):(s=g.listening,s&&0===--s.count&&(delete h[s.id],delete s.listeningTo[s.objId]))}u.length?e[t]=u:delete e[t]}return e}for(var f=i.keys(h);a<f.length;a++)s=h[f[a]],delete h[s.id],delete s.listeningTo[s.objId]}};d.once=function(e,t,n){var r=c(m,{},e,t,i.bind(this.off,this));return"string"==typeof e&&null==n&&(t=void 0),this.on(r,t,n)},d.listenToOnce=function(e,t,n){var r=c(m,{},t,n,i.bind(this.stopListening,this,e));return this.listenTo(e,r)};var m=function(e,t,n,r){if(n){var s=e[t]=i.once(function(){r(t,s),n.apply(this,arguments)});s._callback=n}return e};d.trigger=function(e){if(!this._events)return this;for(var t=Math.max(0,arguments.length-1),i=Array(t),n=0;t>n;n++)i[n]=arguments[n+1];return c(p,this._events,e,void 0,i),this};var p=function(e,t,i,n){if(e){var r=e[t],s=e.all;r&&s&&(s=s.slice()),r&&y(r,n),s&&y(s,[t].concat(n))}return e},y=function(e,t){var i,n=-1,r=e.length,s=t[0],a=t[1],o=t[2];switch(t.length){case 0:for(;++n<r;)(i=e[n]).callback.call(i.ctx);return;case 1:for(;++n<r;)(i=e[n]).callback.call(i.ctx,s);return;case 2:for(;++n<r;)(i=e[n]).callback.call(i.ctx,s,a);return;case 3:for(;++n<r;)(i=e[n]).callback.call(i.ctx,s,a,o);return;default:for(;++n<r;)(i=e[n]).callback.apply(i.ctx,t);return}};d.bind=d.on,d.unbind=d.off,i.extend(t,d);var b=t.Model=function(e,t){var n=e||{};t||(t={}),this.cid=i.uniqueId(this.cidPrefix),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(n=this.parse(n,t)||{});var r=i.result(this,"defaults");n=i.defaults(i.extend({},r,n),r),this.set(n,t),this.changed={},this.initialize.apply(this,arguments)};i.extend(b.prototype,d,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(){return i.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return i.escape(this.get(e))},has:function(e){return null!=this.get(e)},matches:function(e){return!!i.iteratee(e,this)(this.attributes)},set:function(e,t,n){if(null==e)return this;var r;if("object"==typeof e?(r=e,n=t):(r={})[e]=t,n||(n={}),!this._validate(r,n))return!1;var s=n.unset,a=n.silent,o=[],h=this._changing;this._changing=!0,h||(this._previousAttributes=i.clone(this.attributes),this.changed={});var l=this.attributes,d=this.changed,u=this._previousAttributes;for(var c in r)t=r[c],i.isEqual(l[c],t)||o.push(c),i.isEqual(u[c],t)?delete d[c]:d[c]=t,s?delete l[c]:l[c]=t;if(this.idAttribute in r&&(this.id=this.get(this.idAttribute)),!a){o.length&&(this._pending=n);for(var g=0;g<o.length;g++)this.trigger("change:"+o[g],this,l[o[g]],n)}if(h)return this;if(!a)for(;this._pending;)n=this._pending,this._pending=!1,this.trigger("change",this,n);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,i.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var n in this.attributes)t[n]=void 0;return this.set(t,i.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!i.isEmpty(this.changed):i.has(this.changed,e)},changedAttributes:function(e){if(!e)return this.hasChanged()?i.clone(this.changed):!1;var t=this._changing?this._previousAttributes:this.attributes,n={};for(var r in e){var s=e[r];i.isEqual(t[r],s)||(n[r]=s)}return i.size(n)?n:!1},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return i.clone(this._previousAttributes)},fetch:function(e){e=i.extend({parse:!0},e);var t=this,n=e.success;return e.success=function(i){var r=e.parse?t.parse(i,e):i;return t.set(r,e)?(n&&n.call(e.context,t,i,e),void t.trigger("sync",t,i,e)):!1},F(this,e),this.sync("read",this,e)},save:function(e,t,n){var r;null==e||"object"==typeof e?(r=e,n=t):(r={})[e]=t,n=i.extend({validate:!0,parse:!0},n);var s=n.wait;if(r&&!s){if(!this.set(r,n))return!1}else if(!this._validate(r,n))return!1;var a=this,o=n.success,h=this.attributes;n.success=function(e){a.attributes=h;var t=n.parse?a.parse(e,n):e;return s&&(t=i.extend({},r,t)),t&&!a.set(t,n)?!1:(o&&o.call(n.context,a,e,n),void a.trigger("sync",a,e,n))},F(this,n),r&&s&&(this.attributes=i.extend({},h,r));var l=this.isNew()?"create":n.patch?"patch":"update";"patch"!==l||n.attrs||(n.attrs=r);var d=this.sync(l,this,n);return this.attributes=h,d},destroy:function(e){e=e?i.clone(e):{};var t=this,n=e.success,r=e.wait,s=function(){t.stopListening(),t.trigger("destroy",t,t.collection,e)};e.success=function(i){r&&s(),n&&n.call(e.context,t,i,e),t.isNew()||t.trigger("sync",t,i,e)};var a=!1;return this.isNew()?i.defer(e.success):(F(this,e),a=this.sync("delete",this,e)),r||s(),a},url:function(){var e=i.result(this,"urlRoot")||i.result(this.collection,"url")||z();if(this.isNew())return e;var t=this.get(this.idAttribute);return e.replace(/[^\/]$/,"$&/")+encodeURIComponent(t)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},i.extend({},e,{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=i.extend({},this.attributes,e);var n=this.validationError=this.validate(e,t)||null;return n?(this.trigger("invalid",this,n,i.extend(t,{validationError:n})),!1):!0}});var _={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};o(b,_,"attributes");var w=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,i.extend({silent:!0},t))},x={add:!0,remove:!0,merge:!0},A={add:!0,remove:!1},I=function(e,t,i){i=Math.min(Math.max(i,0),e.length);var n,r=Array(e.length-i),s=t.length;for(n=0;n<r.length;n++)r[n]=e[n+i];for(n=0;s>n;n++)e[n+i]=t[n];for(n=0;n<r.length;n++)e[n+s+i]=r[n]};i.extend(w.prototype,d,{model:b,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,i.extend({merge:!1},t,A))},remove:function(e,t){t=i.extend({},t);var n=!i.isArray(e);e=n?[e]:e.slice();var r=this._removeModels(e,t);return!t.silent&&r.length&&(t.changes={added:[],merged:[],removed:r},this.trigger("update",this,t)),n?r[0]:r},set:function(e,t){if(null!=e){t=i.extend({},x,t),t.parse&&!this._isModel(e)&&(e=this.parse(e,t)||[]);var n=!i.isArray(e);e=n?[e]:e.slice();var r=t.at;null!=r&&(r=+r),r>this.length&&(r=this.length),0>r&&(r+=this.length+1);var s,a,o=[],h=[],l=[],d=[],u={},c=t.add,g=t.merge,f=t.remove,v=!1,m=this.comparator&&null==r&&t.sort!==!1,p=i.isString(this.comparator)?this.comparator:null;for(a=0;a<e.length;a++){s=e[a];var y=this.get(s);if(y){if(g&&s!==y){var b=this._isModel(s)?s.attributes:s;t.parse&&(b=y.parse(b,t)),y.set(b,t),l.push(y),m&&!v&&(v=y.hasChanged(p))}u[y.cid]||(u[y.cid]=!0,o.push(y)),e[a]=y}else c&&(s=e[a]=this._prepareModel(s,t),s&&(h.push(s),this._addReference(s,t),u[s.cid]=!0,o.push(s)))}if(f){for(a=0;a<this.length;a++)s=this.models[a],u[s.cid]||d.push(s);d.length&&this._removeModels(d,t)}var _=!1,w=!m&&c&&f;if(o.length&&w?(_=this.length!==o.length||i.some(this.models,function(e,t){return e!==o[t]}),this.models.length=0,I(this.models,o,0),this.length=this.models.length):h.length&&(m&&(v=!0),I(this.models,h,null==r?this.length:r),this.length=this.models.length),v&&this.sort({silent:!0}),!t.silent){for(a=0;a<h.length;a++)null!=r&&(t.index=r+a),s=h[a],s.trigger("add",s,this,t);(v||_)&&this.trigger("sort",this,t),(h.length||d.length||l.length)&&(t.changes={added:h,removed:d,merged:l},this.trigger("update",this,t))}return n?e[0]:e}},reset:function(e,t){t=t?i.clone(t):{};for(var n=0;n<this.models.length;n++)this._removeReference(this.models[n],t);return t.previousModels=this.models,this._reset(),e=this.add(e,i.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,i.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e)},unshift:function(e,t){return this.add(e,i.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e)},slice:function(){return s.apply(this.models,arguments)},get:function(e){return null==e?void 0:this._byId[e]||this._byId[this.modelId(e.attributes||e)]||e.cid&&this._byId[e.cid]},has:function(e){return null!=this.get(e)},at:function(e){return 0>e&&(e+=this.length),this.models[e]},where:function(e,t){return this[t?"find":"filter"](e)},findWhere:function(e){return this.where(e,!0)},sort:function(e){var t=this.comparator;if(!t)throw new Error("Cannot sort a set without a comparator");e||(e={});var n=t.length;return i.isFunction(t)&&(t=i.bind(t,this)),1===n||i.isString(t)?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return this.map(e+"")},fetch:function(e){e=i.extend({parse:!0},e);var t=e.success,n=this;return e.success=function(i){var r=e.reset?"reset":"set";n[r](i,e),t&&t.call(e.context,n,i,e),n.trigger("sync",n,i,e)},F(this,e),this.sync("read",this,e)},create:function(e,t){t=t?i.clone(t):{};var n=t.wait;if(e=this._prepareModel(e,t),!e)return!1;n||this.add(e,t);var r=this,s=t.success;return t.success=function(e,t,i){n&&r.add(e,i),s&&s.call(i.context,e,t,i)},e.save(null,t),e},parse:function(e){return e},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(e){return e[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(this._isModel(e))return e.collection||(e.collection=this),e;t=t?i.clone(t):{},t.collection=this;var n=new this.model(e,t);return n.validationError?(this.trigger("invalid",this,n.validationError,t),!1):n},_removeModels:function(e,t){for(var i=[],n=0;n<e.length;n++){var r=this.get(e[n]);if(r){var s=this.indexOf(r);this.models.splice(s,1),this.length--,delete this._byId[r.cid];var a=this.modelId(r.attributes);null!=a&&delete this._byId[a],t.silent||(t.index=s,r.trigger("remove",r,this,t)),i.push(r),this._removeReference(r,t)}}return i},_isModel:function(e){return e instanceof b},_addReference:function(e){this._byId[e.cid]=e;var t=this.modelId(e.attributes);null!=t&&(this._byId[t]=e),e.on("all",this._onModelEvent,this)},_removeReference:function(e){delete this._byId[e.cid];var t=this.modelId(e.attributes);null!=t&&delete this._byId[t],this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){if(t){if(("add"===e||"remove"===e)&&i!==this)return;if("destroy"===e&&this.remove(t,n),"change"===e){var r=this.modelId(t.previousAttributes()),s=this.modelId(t.attributes);r!==s&&(null!=r&&delete this._byId[r],null!=s&&(this._byId[s]=t))}}this.trigger.apply(this,arguments)}});var M={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};o(w,M,"models");var C=t.View=function(e){this.cid=i.uniqueId("view"),i.extend(this,i.pick(e,D)),this._ensureElement(),this.initialize.apply(this,arguments)},E=/^(\S+)\s*(.*)$/,D=["model","collection","el","id","attributes","className","tagName","events"];i.extend(C.prototype,d,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this._removeElement(),this.stopListening(),this},_removeElement:function(){this.$el.remove()},setElement:function(e){return this.undelegateEvents(),this._setElement(e),this.delegateEvents(),this},_setElement:function(e){this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0]},delegateEvents:function(e){if(e||(e=i.result(this,"events")),!e)return this;this.undelegateEvents();for(var t in e){var n=e[t];if(i.isFunction(n)||(n=this[n]),n){var r=t.match(E);this.delegate(r[1],r[2],i.bind(n,this))}}return this},delegate:function(e,t,i){return this.$el.on(e+".delegateEvents"+this.cid,t,i),this},undelegateEvents:function(){return this.$el&&this.$el.off(".delegateEvents"+this.cid),this},undelegate:function(e,t,i){return this.$el.off(e+".delegateEvents"+this.cid,t,i),this},_createElement:function(e){return document.createElement(e)},_ensureElement:function(){if(this.el)this.setElement(i.result(this,"el"));else{var e=i.extend({},i.result(this,"attributes"));this.id&&(e.id=i.result(this,"id")),this.className&&(e["class"]=i.result(this,"className")),this.setElement(this._createElement(i.result(this,"tagName"))),this._setAttributes(e)}},_setAttributes:function(e){this.$el.attr(e)}}),t.sync=function(e,n,r){var s=k[e];i.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var a={type:s,dataType:"json"};if(r.url||(a.url=i.result(n,"url")||z()),null!=r.data||!n||"create"!==e&&"update"!==e&&"patch"!==e||(a.contentType="application/json",a.data=JSON.stringify(r.attrs||n.toJSON(r))),r.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){a.type="POST",r.emulateJSON&&(a.data._method=s);var o=r.beforeSend;r.beforeSend=function(e){return e.setRequestHeader("X-HTTP-Method-Override",s),o?o.apply(this,arguments):void 0}}"GET"===a.type||r.emulateJSON||(a.processData=!1);var h=r.error;r.error=function(e,t,i){r.textStatus=t,r.errorThrown=i,h&&h.call(r.context,e,t,i)};var l=r.xhr=t.ajax(i.extend(a,r));return n.trigger("request",n,l,r),l};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var V=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},$=/\((.*?)\)/g,R=/(\(\?)?:\w+/g,T=/\*\w+/g,B=/[\-{}\[\]+?.,\\\^$|#\s]/g;i.extend(V.prototype,d,{initialize:function(){},route:function(e,n,r){i.isRegExp(e)||(e=this._routeToRegExp(e)),i.isFunction(n)&&(r=n,n=""),r||(r=this[n]);var s=this;return t.history.route(e,function(i){var a=s._extractParameters(e,i);s.execute(r,a,n)!==!1&&(s.trigger.apply(s,["route:"+n].concat(a)),s.trigger("route",n,a),t.history.trigger("route",s,n,a))}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,i){return t.history.navigate(e,i),this},_bindRoutes:function(){if(this.routes){this.routes=i.result(this,"routes");for(var e,t=i.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(B,"\\$&").replace($,"(?:$1)?").replace(R,function(e,t){return t?e:"([^/?]+)"}).replace(T,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var n=e.exec(t).slice(1);return i.map(n,function(e,t){return t===n.length-1?e||null:e?decodeURIComponent(e):null})}});var O=t.History=function(){this.handlers=[],this.checkUrl=i.bind(this.checkUrl,this),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},P=/^[#\/]|\s+$/g,S=/^\/+|\/+$/g,q=/#.*$/;O.started=!1,i.extend(O.prototype,d,{interval:50,atRoot:function(){var e=this.location.pathname.replace(/[^\/]$/,"$&/");return e===this.root&&!this.getSearch()},matchRoot:function(){var e=this.decodeFragment(this.location.pathname),t=e.slice(0,this.root.length-1)+"/";return t===this.root},decodeFragment:function(e){return decodeURI(e.replace(/%25/g,"%2525"))},getSearch:function(){var e=this.location.href.replace(/#.*/,"").match(/\?.+/);return e?e[0]:""},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getPath:function(){var e=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return"/"===e.charAt(0)?e.slice(1):e},getFragment:function(e){return null==e&&(e=this._usePushState||!this._wantsHashChange?this.getPath():this.getHash()),e.replace(P,"")},start:function(e){if(O.started)throw new Error("Backbone.history has already been started");if(O.started=!0,this.options=i.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._hasHashChange="onhashchange"in window&&(void 0===document.documentMode||document.documentMode>7),this._useHashChange=this._wantsHashChange&&this._hasHashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!(!this.history||!this.history.pushState),this._usePushState=this._wantsPushState&&this._hasPushState,this.fragment=this.getFragment(),this.root=("/"+this.root+"/").replace(S,"/"),this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var t=this.root.slice(0,-1)||"/";return this.location.replace(t+"#"+this.getPath()),!0}this._hasPushState&&this.atRoot()&&this.navigate(this.getHash(),{replace:!0})}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe"),this.iframe.src="javascript:0",this.iframe.style.display="none",this.iframe.tabIndex=-1;var n=document.body,r=n.insertBefore(this.iframe,n.firstChild).contentWindow;r.document.open(),r.document.close(),r.location.hash="#"+this.fragment}var s=window.addEventListener||function(e,t){return attachEvent("on"+e,t)};return this._usePushState?s("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe?s("hashchange",this.checkUrl,!1):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.options.silent?void 0:this.loadUrl()},stop:function(){var e=window.removeEventListener||function(e,t){return detachEvent("on"+e,t)};this._usePushState?e("popstate",this.checkUrl,!1):this._useHashChange&&!this.iframe&&e("hashchange",this.checkUrl,!1),this.iframe&&(document.body.removeChild(this.iframe),this.iframe=null),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),O.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e===this.fragment&&this.iframe&&(e=this.getHash(this.iframe.contentWindow)),e===this.fragment?!1:(this.iframe&&this.navigate(e),void this.loadUrl())},loadUrl:function(e){return this.matchRoot()?(e=this.fragment=this.getFragment(e),i.some(this.handlers,function(t){return t.route.test(e)?(t.callback(e),!0):void 0})):!1},navigate:function(e,t){if(!O.started)return!1;t&&t!==!0||(t={trigger:!!t}),e=this.getFragment(e||"");var i=this.root;(""===e||"?"===e.charAt(0))&&(i=i.slice(0,-1)||"/");var n=i+e;if(e=this.decodeFragment(e.replace(q,"")),this.fragment!==e){if(this.fragment=e,this._usePushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);if(this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getHash(this.iframe.contentWindow)){var r=this.iframe.contentWindow;t.replace||(r.document.open(),r.document.close()),this._updateHash(r.location,e,t.replace)}}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,i){if(i){var n=e.href.replace(/(javascript:|#).*$/,"");e.replace(n+"#"+t)}else e.hash="#"+t}}),t.history=new O;var N=function(e,t){var n,r=this;return n=e&&i.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},i.extend(n,r,t),n.prototype=i.create(r.prototype,e),n.prototype.constructor=n,n.__super__=r.prototype,n};b.extend=w.extend=V.extend=C.extend=O.extend=N;var z=function(){throw new Error('A "url" property or function must be specified')},F=function(e,t){var i=t.error;t.error=function(n){i&&i.call(t.context,e,n,t),e.trigger("error",e,n,t)}};return t}),!function(e,t){if("function"==typeof define&&define.amd)define(["backbone","underscore"],function(i,n){return e.Marionette=e.Mn=t(e,i,n)});else if("undefined"!=typeof exports){var i=require("backbone"),n=require("underscore");module.exports=t(e,i,n)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,i){"use strict";!function(e,t){var i=e.ChildViewContainer;return e.ChildViewContainer=function(e,t){var i=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(i.prototype,{add:function(e,t){var i=e.cid;return this._views[i]=e,e.model&&(this._indexByModel[e.model.cid]=i),t&&(this._indexByCustom[t]=i),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var i=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){return e===i?(delete this._indexByCustom[t],!0):void 0},this),delete this._views[i],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,i){t.each(this._views,function(n){t.isFunction(n[e])&&n[e].apply(n,i||[])})},_updateLength:function(){this.length=t.size(this._views)}});var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(n,function(e){i.prototype[e]=function(){var i=t.values(this._views),n=[i].concat(t.toArray(arguments));return t[e].apply(t,n)}}),i}(e,t),e.ChildViewContainer.VERSION="0.1.11",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=i,this},e.ChildViewContainer}(t,i),function(e,t){var i=e.Wreqr,n=e.Wreqr={};return e.Wreqr.VERSION="1.3.6",e.Wreqr.noConflict=function(){return e.Wreqr=i,this},n.Handlers=function(e,t){var i=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,i){var n=null;t.isObject(e)&&!t.isFunction(e)&&(n=e.context,e=e.callback),this.setHandler(i,e,n)},this)},setHandler:function(e,t,i){var n={callback:t,context:i};this._wreqrHandlers[e]=n,this.trigger("handler:add",e,t,i)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];return t?function(){return t.callback.apply(t.context,arguments)}:void 0},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),i}(e,t),n.CommandStorage=function(){var i=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(i.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){var i=this.getCommands(e);i.instances.push(t)},clearCommands:function(e){var t=this.getCommands(e);t.instances=[]}}),i}(),n.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var i=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,i):this.storage.addCommand(e,i)},_executeCommands:function(e,i,n){var r=this.storage.getCommands(e);t.each(r.instances,function(e){i.apply(n,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var i,n=e.storageType||this.storageType;i=t.isFunction(n)?new n:n,this.storage=i}})}(n,t),n.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){return this.hasHandler(e)?this.getHandler(e).apply(this,t.rest(arguments)):void 0}})}(n,t),n.EventAggregator=function(e,t){var i=function(){};return i.extend=e.Model.extend,t.extend(i.prototype,e.Events),i}(e,t),n.Channel=function(){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,i,n){if(i){n=n||this;var r="vent"===e?"on":"setHandler";t.each(i,function(i,s){this[e][r](s,t.bind(i,n))},this)}}}),i}(n),n.radio=function(e,t){var i=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(i.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var i=this._channels[t];return i||(i=new e.Channel(t),this._channels[t]=i),i},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(n[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var n={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,i,n){return function(r){var s=e._getChannel(r)[i];return s[n].apply(s,t.rest(arguments))}};return new i}(n,t),e.Wreqr}(t,i);var n=e.Marionette,r=e.Mn,s=t.Marionette={};s.VERSION="2.4.7",s.noConflict=function(){return e.Marionette=n,e.Mn=r,this},t.Marionette=s,s.Deferred=t.$.Deferred,s.extend=t.Model.extend,s.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},s.mergeOptions=function(e,t){e&&i.extend(this,i.pick(e,t))},s.getOption=function(e,t){return e&&t?e.options&&void 0!==e.options[t]?e.options[t]:e[t]:void 0},s.proxyGetOption=function(e){return s.getOption(this,e)},s._getValue=function(e,t,n){return i.isFunction(e)&&(e=n?e.apply(t,n):e.call(t)),e},s.normalizeMethods=function(e){return i.reduce(e,function(e,t,n){return i.isFunction(t)||(t=this[t]),t&&(e[n]=t),e},{},this)},s.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},s.normalizeUIKeys=function(e,t){return i.reduce(e,function(e,i,n){var r=s.normalizeUIString(n,t);
return e[r]=i,e},{})},s.normalizeUIValues=function(e,t,n){return i.each(e,function(r,a){i.isString(r)?e[a]=s.normalizeUIString(r,t):i.isObject(r)&&i.isArray(n)&&(i.extend(r,s.normalizeUIValues(i.pick(r,n),t)),i.each(n,function(e){var n=r[e];i.isString(n)&&(r[e]=s.normalizeUIString(n,t))}))}),e},s.actAsCollection=function(e,t){var n=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];i.each(n,function(n){e[n]=function(){var e=i.values(i.result(this,t)),r=[e].concat(i.toArray(arguments));return i[n].apply(i,r)}})};var a=s.deprecate=function(e,t){i.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||a._cache[e]||(a._warn("Deprecation warning: "+e),a._cache[e]=!0)};a._console="undefined"!=typeof console?console:{},a._warn=function(){var e=a._console.warn||a._console.log||function(){};return e.apply(a._console,arguments)},a._cache={},s._triggerMethod=function(){function e(e,t,i){return i.toUpperCase()}var t=/(^|:)(\w)/gi;return function(n,r,s){var a=arguments.length<3;a&&(s=r,r=s[0]);var o,h="on"+r.replace(t,e),l=n[h];return i.isFunction(l)&&(o=l.apply(n,a?i.rest(s):s)),i.isFunction(n.trigger)&&(a+s.length>1?n.trigger.apply(n,a?s:[r].concat(i.drop(s,0))):n.trigger(r)),o}}(),s.triggerMethod=function(){return s._triggerMethod(this,arguments)},s.triggerMethodOn=function(e){var t=i.isFunction(e.triggerMethod)?e.triggerMethod:s.triggerMethod;return t.apply(e,i.rest(arguments))},s.MonitorDOMRefresh=function(e){function t(){e._isShown=!0,n()}function i(){e._isRendered=!0,n()}function n(){e._isShown&&e._isRendered&&s.isNodeAttached(e.el)&&s.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:t,render:i}))},function(e){function t(t,n,r,s){var a=s.split(/\s+/);i.each(a,function(i){var s=t[i];if(!s)throw new e.Error('Method "'+i+'" was configured as an event handler, but does not exist.');t.listenTo(n,r,s)})}function n(e,t,i,n){e.listenTo(t,i,n)}function r(e,t,n,r){var s=r.split(/\s+/);i.each(s,function(i){var r=e[i];e.stopListening(t,n,r)})}function s(e,t,i,n){e.stopListening(t,i,n)}function a(t,n,r,s,a){if(n&&r){if(!i.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),i.each(r,function(e,r){i.isFunction(e)?s(t,n,r,e):a(t,n,r,e)})}}e.bindEntityEvents=function(e,i,r){a(e,i,r,n,t)},e.unbindEntityEvents=function(e,t,i){a(e,t,i,s,r)},e.proxyBindEntityEvents=function(t,i){return e.bindEntityEvents(this,t,i)},e.proxyUnbindEntityEvents=function(t,i){return e.unbindEntityEvents(this,t,i)}}(s);var o=["description","fileName","lineNumber","name","message","number"];return s.Error=s.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+s.VERSION+"/",constructor:function(e,t){i.isObject(e)?(t=e,e=t.message):t||(t={});var n=Error.call(this,e);i.extend(this,i.pick(n,o),i.pick(t,o)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,s.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),s.Error.extend=s.extend,s.Callbacks=function(){this._deferred=s.Deferred(),this._callbacks=[]},i.extend(s.Callbacks.prototype,{add:function(e,t){var n=i.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),n.then(function(i){t&&(i.context=t),e.call(i.context,i.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=s.Deferred(),this._callbacks=[],i.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),s.Controller=function(e){this.options=e||{},i.isFunction(this.initialize)&&this.initialize(this.options)},s.Controller.extend=s.extend,i.extend(s.Controller.prototype,t.Events,{destroy:function(){return s._triggerMethod(this,"before:destroy",arguments),s._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:s.triggerMethod,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption}),s.Object=function(e){this.options=i.extend({},i.result(this,"options"),e),this.initialize.apply(this,arguments)},s.Object.extend=s.extend,i.extend(s.Object.prototype,t.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:s.triggerMethod,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.Region=s.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new s.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),s.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),s.MonitorDOMRefresh(e);var n=t||{},r=e!==this.currentView,a=!!n.preventDestroy,o=!!n.forceShow,h=!!this.currentView,l=r&&!a,d=r||o;if(h&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&r&&delete this.currentView._parent,l?this.empty():h&&d&&this.currentView.off("destroy",this.empty,this),d){e.once("destroy",this.empty,this),e._parent=this,this._renderView(e),h&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),s.triggerMethodOn(e,"before:show",e,this,t),h&&this.triggerMethod("swapOut",this.currentView,this,t);var u=s.isNodeAttached(this.el),c=[],g=i.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},n);return u&&g.triggerBeforeAttach&&(c=this._displayedViews(e),this._triggerAttach(c,"before:")),this.attachHtml(e),this.currentView=e,u&&g.triggerAttach&&(c=this._displayedViews(e),this._triggerAttach(c)),h&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),s.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var n=(t||"")+"attach";i.each(e,function(e){s.triggerMethodOn(e,n,e,this)},this)},_displayedViews:function(e){return i.union([e],i.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||s.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||s.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(i.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new s.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new s.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new s.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,s._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,i=e||{},n=!!i.preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),n||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,n&&this.$el.contents().detach(),this):this},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||s.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(i.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(i.isFunction(e))return this._buildRegionFromRegionClass(e);throw new s.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var n=e.regionClass||t,r=i.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new n(r)},_buildRegionFromRegionClass:function(e){return new e}}),s.RegionManager=s.Controller.extend({constructor:function(e){this._regions={},this.length=0,s.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=s._getValue(e,this,arguments),i.reduce(e,function(e,n,r){return i.isString(n)&&(n={selector:n}),n.selector&&(n=i.defaults({},n,t)),e[r]=this.addRegion(r,n),e},{},this)},addRegion:function(e,t){var i;return i=t instanceof s.Region?t:s.Region.buildRegion(t,s.Region),this.triggerMethod("before:add:region",e,i),i._parent=this,this._store(e,i),this.triggerMethod("add:region",e,i),i},get:function(e){return this._regions[e]},getRegions:function(){return i.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return i.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return i.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),s.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),s.actAsCollection(s.RegionManager.prototype,"_regions"),s.TemplateCache=function(e){this.templateId=e},i.extend(s.TemplateCache,{templateCaches:{},get:function(e,t){var i=this.templateCaches[e];return i||(i=new s.TemplateCache(e),this.templateCaches[e]=i),i.load(t)},clear:function(){var e,t=i.toArray(arguments),n=t.length;if(n>0)for(e=0;n>e;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),i.extend(s.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e){var i=t.$(e);if(!i.length)throw new s.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return i.html()},compileTemplate:function(e,t){return i.template(e,t)}}),s.Renderer={render:function(e,t){if(!e)throw new s.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});var n=i.isFunction(e)?e:s.TemplateCache.get(e);return n(t)}},s.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=i.bind(this.render,this),e=s._getValue(e,this),this.options=i.extend({},i.result(this,"options"),e),this._behaviors=s.Behaviors(this),t.View.call(this,this.options),s.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,i.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=s._getValue(t,this),i.extend(e,t)},normalizeUIKeys:function(e){var t=i.result(this,"_uiBindings");return s.normalizeUIKeys(e,t||i.result(this,"ui"))},normalizeUIValues:function(e,t){var n=i.result(this,"ui"),r=i.result(this,"_uiBindings");return s.normalizeUIValues(e,r||n,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(i.result(this,"triggers"));return i.reduce(e,function(e,t,i){return e[i]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var n=s._getValue(e||this.events,this);n=this.normalizeUIKeys(n),i.isUndefined(e)&&(this.events=n);var r={},a=i.result(this,"behaviorEvents")||{},o=this.configureTriggers(),h=i.result(this,"behaviorTriggers")||{};i.extend(r,a,n,o,h),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),i.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new s.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=i.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),i.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),i.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=i.result(this,"_uiBindings");this.ui={},i.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),i.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(i.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=i.defaults({},e,{preventDefault:!0,stopPropagation:!0}),n=i.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var i={view:this,model:this.model,collection:this.collection};this.triggerMethod(n,i)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return i.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=s._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],i.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=s._triggerMethod,i=this._behaviors,n=0,r=i&&i.length;r>n;n++)t(i[n],e)},_triggerEventOnParentLayout:function(e,t){var n=this._parentLayoutView();if(n){var r=s.getOption(n,"childViewEventPrefix"),a=r+":"+e,o=[this].concat(t);s._triggerMethod(n,a,o);var h=s.getOption(n,"childEvents");h=s._getValue(h,n);var l=n.normalizeMethods(h);l&&i.isFunction(l[e])&&l[e].apply(n,o)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?i.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof s.LayoutView)return e;e=e._parent}},normalizeMethods:s.normalizeMethods,mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.ItemView=s.View.extend({constructor:function(){s.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,i.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(e!==!1){if(!e)throw new s.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),i=s.Renderer.render(e,t,this);return this.attachElContent(i),this}},attachElContent:function(e){return this.$el.html(e),this}}),s.CollectionView=s.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(){this.once("render",this._initialEvents),this._initChildViewStorage(),s.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&s.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,n){var r=i.drop(arguments,3);i.each(e,function(e){s.triggerMethodOn.apply(e,[e,n,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,n){var r=void 0!==n.at&&(n.index||t.indexOf(e));if((this.getOption("filter")||r===!1)&&(r=i.indexOf(this._filteredSortedModels(r),e)),this._shouldAddChild(e,r)){this.destroyEmptyView();var s=this.getChildView(e);this.addChild(e,s,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){s.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){s.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels();if(!t.length&&this._showingEmptyView)return this;var n=i.some(t,function(t){return!e.findByModel(t)});if(n)this.render();else{var r=i.map(t,function(t,i){var n=e.findByModel(t);return n._index=i,n.el}),s=e.filter(function(e){return!i.contains(r,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(r),i.each(s,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){s.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels(),t=i.find(e,function(e,t){var i=this.children.findByModel(e);return!i||i._index!==t},this);t&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();i.each(t,function(t,i){e=this.getChildView(t),this.addChild(t,e,i)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),n=this.collection.models;if(e=Math.min(Math.max(e,0),n.length-1),t){var r;e&&(r=n[e],n=n.slice(0,e).concat(n.slice(e+1))),n=this._sortModelsBy(n,t),r&&n.splice(e,0,r)}return this.getOption("filter")&&(n=i.filter(n,function(e,t){return this._shouldAddChild(e,t)},this)),n},_sortModelsBy:function(e,t){return"string"==typeof t?i.sortBy(e,function(e){return e.get(t)},this):1===t.length?i.sortBy(e,t,this):e.sort(i.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var i=new t.Model;this.addEmptyView(i,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var n,r=this._isShown&&!this.isBuffering&&s.isNodeAttached(this.el),a=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");i.isFunction(a)&&(a=a.call(this,e,this._emptyViewIndex));var o=this.buildChildView(e,t,a);o._parent=this,this.proxyChildEvents(o),o.once("render",function(){this._isShown&&s.triggerMethodOn(o,"before:show",o),r&&this._triggerBeforeAttach&&(n=this._getViewAndNested(o),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(o),this.renderChildView(o,this._emptyViewIndex),r&&this._triggerAttach&&(n=this._getViewAndNested(o),this._triggerMethodMany(n,this,"attach")),this._isShown&&s.triggerMethodOn(o,"show",o)},getChildView:function(){var e=this.getOption("childView");if(!e)throw new s.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return e},addChild:function(e,t,i){var n=this.getOption("childViewOptions");n=s._getValue(n,this,[e,i]);var r=this.buildChildView(e,t,n);return this._updateIndices(r,!0,i),this.triggerMethod("before:add:child",r),this._addChildView(r,i),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,i){this.getOption("sort")&&(t&&(e._index=i),this.children.each(function(i){i._index>=e._index&&(i._index+=t?1:-1)}))},_addChildView:function(e,t){var i,n=this._isShown&&!this.isBuffering&&s.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&s.triggerMethodOn(e,"before:show",e),n&&this._triggerBeforeAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),n&&this._triggerAttach&&(i=this._getViewAndNested(e),this._triggerMethodMany(i,this,"attach")),this._isShown&&!this.isBuffering&&s.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||s.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||s.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,n){var r=i.extend({model:e},n),a=new t(r);return s.MonitorDOMRefresh(a),a},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||s.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return i.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,i){e.isBuffering?e._bufferedChildren.splice(i,0,t):e._insertBefore(t,i)||e._insertAfter(t)},_insertBefore:function(e,t){var i,n=this.getOption("sort")&&t<this.children.length-1;return n&&(i=this.children.find(function(e){return e._index===t+1})),i?(i.$el.before(e.el),!0):!1},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),s.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},n=!0,r=this.children.map(i.identity);return i.isUndefined(t.checkEmpty)||(n=t.checkEmpty),this.children.each(this.removeChildView,this),n&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var n=this.getOption("filter");return!i.isFunction(n)||n.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var n=i.toArray(arguments),r=n[0],s=this.normalizeMethods(i.result(this,"childEvents"));n[0]=t+":"+r,n.splice(1,0,e),"undefined"!=typeof s&&i.isFunction(s[r])&&s[r].apply(this,n.slice(1)),this.triggerMethod.apply(this,n)})},_getImmediateChildren:function(){return i.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(i.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),s.CompositeView=s.CollectionView.extend({constructor:function(){s.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(){var e=this.getOption("childView")||this.constructor;return e},serializeData:function(){var e={};return this.model&&(e=i.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&s.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),i=s.Renderer.render(t,e,this);this.attachElContent(i),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){var i=this.getChildViewContainer(e);i.append(t)},_insertAfter:function(e){var t=this.getChildViewContainer(this,e);t.append(e.el)},_appendReorderedChildren:function(e){var t=this.getChildViewContainer(this);t.append(e)},getChildViewContainer:function(e){if(e.$childViewContainer)return e.$childViewContainer;var t,i=s.getOption(e,"childViewContainer");if(i){var n=s._getValue(i,e);if(t="@"===n.charAt(0)&&e.ui?e.ui[n.substr(4)]:e.$(n),t.length<=0)throw new s.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else t=e.$el;return e.$childViewContainer=t,t},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),s.LayoutView=s.ItemView.extend({regionClass:s.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),s.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),s.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(this.getOption("destroyImmediate")===!0&&this.$el.remove(),this.regionManager.destroy(),s.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e){var t=this.getRegion(e);return t.show.apply(t,i.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var i={};return i[e]=t,this._buildRegions(i)[e]},addRegions:function(e){return this.regions=i.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:i.partial(i.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=s._getValue(this.regions,this,[e])||{};var n=this.getOption.call(e,"regions");n=s._getValue(n,this,[e]),i.extend(t,n),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new s.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return i.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),s.Behavior=s.Object.extend({constructor:function(e,t){this.view=t,this.defaults=i.result(this,"defaults")||{},this.options=i.extend({},this.defaults,e),this.ui=i.extend({},i.result(t,"ui"),i.result(this,"ui")),s.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),s.Behaviors=function(e,t){function i(e,n){return t.isObject(e.behaviors)?(n=i.parseBehaviors(e,n||t.result(e,"behaviors")),i.wrap(e,n,t.keys(a)),n):{}}function n(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var s=/^(\S+)\s*(.*)$/,a={behaviorTriggers:function(e,t){var i=new n(this,t);return i.buildBehaviorTriggers()},behaviorEvents:function(i,n){var a={};return t.each(n,function(i,n){var o={},h=t.clone(t.result(i,"events"))||{};h=e.normalizeUIKeys(h,r(i));var l=0;t.each(h,function(e,r){var a=r.match(s),h=a[1]+"."+[this.cid,n,l++," "].join(""),d=a[2],u=h+d,c=t.isFunction(e)?e:i[e];c&&(o[u]=t.bind(c,i))},this),a=t.extend(a,o)},this),a}};return t.extend(i,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,n){return t.behaviorClass?t.behaviorClass:e._getValue(i.behaviorsLookup,this,[t,n])[n]},parseBehaviors:function(e,n){return t.chain(n).map(function(n,r){var s=i.getBehaviorClass(n,r),a=new s(n,e),o=i.parseBehaviors(e,t.result(a,"behaviors"));return[a].concat(o)}).flatten().value()},wrap:function(e,i,n){t.each(n,function(n){e[n]=t.partial(a[n],e[n],i)})}}),t.extend(n.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers
},_buildTriggerHandlersForBehavior:function(i,n){var s=t.clone(t.result(i,"triggers"))||{};s=e.normalizeUIKeys(s,r(i)),t.each(s,t.bind(this._setHandlerForBehavior,this,i,n))},_setHandlerForBehavior:function(e,t,i,n){var r=n.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(i)}}),i}(s,i),s.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var i=this.getOption("appRoutes"),n=this._getController();this.processAppRoutes(n,i),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var i=this._getController();this._addAppRoute(i,e,t)},_processOnRoute:function(e,t){if(i.isFunction(this.onRoute)){var n=i.invert(this.getOption("appRoutes"))[e];this.onRoute(e,n,t)}},processAppRoutes:function(e,t){if(t){var n=i.keys(t).reverse();i.each(n,function(i){this._addAppRoute(e,i,t[i])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,n){var r=e[n];if(!r)throw new s.Error('Method "'+n+'" was not found on the controller');this.route(t,n,i.bind(r,e))},mergeOptions:s.mergeOptions,getOption:s.proxyGetOption,triggerMethod:s.triggerMethod,bindEntityEvents:s.proxyBindEntityEvents,unbindEntityEvents:s.proxyUnbindEntityEvents}),s.Application=s.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new s.Callbacks,this.submodules={},i.extend(this,e),this._initChannel(),s.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var n=s.Module.getClass(t),r=i.toArray(arguments);return r.unshift(this),n.create.apply(n,r)},getRegionManager:function(){return new s.RegionManager},_initializeRegions:function(e){var t=i.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var n=s.getOption(e,"regions");return i.isFunction(n)&&(n=n.call(this,e)),i.extend(t,n),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){s._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,s._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){s._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],s._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=i.result(this,"channelName")||"global",this.channel=i.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=i.result(this,"vent")||this.channel.vent,this.commands=i.result(this,"commands")||this.channel.commands,this.reqres=i.result(this,"reqres")||this.channel.reqres}}),s.Module=function(e,t,n){this.moduleName=e,this.options=i.extend({},this.options,n),this.initialize=n.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,i.isFunction(this.initialize)&&this.initialize(e,t,this.options)},s.Module.extend=s.extend,i.extend(s.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(i.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),i.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,n){if(e){var r=i.flatten([this,this.app,t,s,t.$,i,n]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new s.Callbacks,this._finalizerCallbacks=new s.Callbacks},triggerMethod:s.triggerMethod}),i.extend(s.Module,{create:function(e,t,n){var r=e,s=i.drop(arguments,3);t=t.split(".");var a=t.length,o=[];return o[a-1]=n,i.each(t,function(t,i){var a=r;r=this._getModule(a,t,e,n),this._addModuleDefinition(a,r,o[i],s)},this),r},_getModule:function(e,t,n,r){var s=i.extend({},r),a=this.getClass(r),o=e[t];return o||(o=new a(t,n,s),e[t]=o,e.submodules[t]=o),o},getClass:function(e){var t=s.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,i,n){var r=this._getDefine(i),s=this._getStartWithParent(i,t);r&&t.addDefinition(r,n),this._addStartWithParent(e,t,s)},_getStartWithParent:function(e,t){var n;return i.isFunction(e)&&e.prototype instanceof s.Module?(n=t.constructor.prototype.startWithParent,i.isUndefined(n)?!0:n):i.isObject(e)?(n=e.startWithParent,i.isUndefined(n)?!0:n):!0},_getDefine:function(e){return!i.isFunction(e)||e.prototype instanceof s.Module?i.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,i){t.startWithParent=t.startWithParent&&i,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),s});var Adventure=new Marionette.Application;Adventure.Templates={},Adventure.assetPath="undefined"!=typeof Adventure.assetPath?Adventure.assetPath:"",Marionette.TemplateCache.prototype.loadTemplate=function(e){return Adventure.Templates[e]},Adventure.addCSSSupport=function(e){return keyframes=e.replace(/transform: ([^;]+);/g,"transform: $1; -webkit-transform: $1; -ms-transform: $1;"),keyframes=keyframes.replace(/filter: ([^;]+);/g,"filter: $1; -webkit-filter: $1; -moz-filter: $1;")},Adventure.AdventureModel=Backbone.Model.extend({defaults:{hashKey:"",title:"",description:"",author:"",imageID:"",imageURL:"",imageX:"50%",imageY:"50%",imageScale:"1",published:0},idAttribute:"ID",initialize:function(){this.set("events",new Adventure.Events),this.set("scenes",new Adventure.Scenes),this.set("images",new Adventure.Images),this.set("effects",new Adventure.Effects),this.set("pages",new Adventure.Pages),this.set("flags",new Adventure.Flags),this.set("unassignedScene",new Adventure.SceneModel({ID:0,name:"Unassigned"})),this.form=this.attributes},urlRoot:"services/adventure.php",parse:function(e){var t=["pages","flags","events","scenes","images","effects"];for(i=0;i<t.length;i++)void 0!=e[t[i]]&&(this.get(t[i]).add(e[t[i]]),delete e[t[i]]);return e},validate:function(){var e=validate(this.form,[{name:"title",required:!0,type:"string",maxLength:100},{name:"description",required:!0,type:"string",maxLength:500}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.Adventures=Backbone.Collection.extend({model:Adventure.AdventureModel,url:"services/adventures.php"}),Adventure.AdventureViewingModel=Backbone.Model.extend({defaults:{hashKey:"",title:"",description:"",imageID:0,published:0,events:[],scenes:[],images:[],effects:[],pages:[],flags:[]},idAttribute:"ID",initialize:function(){var e=this;Adventure.activeAdventure=this,this.urlRoot=Adventure.assetPath+this.urlRoot,this.fetch({wait:!0,data:{hashKey:this.get("hashKey")},success:function(){e.set("scenes",new Adventure.Scenes(e.get("scenes"))),e.set("images",new Adventure.Images(e.get("images"))),e.set("effects",new Adventure.Effects(e.get("effects"))),e.set("pages",new Adventure.Pages(e.get("pages"))),e.set("flags",new Adventure.Flags(e.get("flags"))),e.set("events",new Adventure.Events(e.get("events")))},error:function(){alert("An error occurred while loading the adventure.")}})},urlRoot:"services/loadAdventure.php"}),Adventure.PageModel=Backbone.Model.extend({defaults:{name:"",text:"",sceneID:0,pageTypeID:1,imageID:0,effectID:0,actions:[],pageEvents:[]},idAttribute:"ID",initialize:function(){this.initSubItems(),this.form=this.attributes,this.handleBlankName(),this.on("sync",this.handleBlankName),this.set("filteredText",this.get("text").replace(/\r?\n/g,"<br>"))},initSubItems:function(){Array.isArray(this.get("actions"))&&this.set("actions",new Adventure.Actions(this.get("actions"))),Array.isArray(this.get("pageEvents"))&&this.set("pageEvents",new Adventure.PageEvents(this.get("pageEvents")))},handleBlankName:function(){this.get("name")||this.set("name","(New page #"+this.id+")")},urlRoot:"services/page.php",validate:function(){var e=validate(this.form,[{name:"name",required:!0,type:"string",maxLength:50},{name:"text",required:!0,type:"string",maxLength:2e3},{name:"sceneID",required:!0,type:"uint"},{name:"pageTypeID",required:!0,type:"tinyint"},{name:"imageID",required:!1,type:"uint"},{name:"effectID",required:!1,type:"uint"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.Pages=Backbone.Collection.extend({model:Adventure.PageModel}),Adventure.ActionModel=Backbone.Model.extend({defaults:{priority:1,actionTypeID:1,text:"",nextPageID:0,effectID:0,transitionID:1,actionFlagRequirements:[],actionEvents:[]},idAttribute:"ID",initialize:function(){this.initSubItems(),this.form=this.attributes,this.handleBlankName(),this.on("sync",this.handleBlankName)},initSubItems:function(){Array.isArray(this.get("actionFlagRequirements"))&&this.set("actionFlagRequirements",new Adventure.ActionFlagRequirements(this.get("actionFlagRequirements"))),Array.isArray(this.get("actionEvents"))&&this.set("actionEvents",new Adventure.ActionEvents(this.get("actionEvents")))},handleBlankName:function(){this.get("text")||this.set("text","(New action #"+this.id+")")},urlRoot:"services/action.php",validate:function(){var e=validate(this.form,[{name:"priority",required:!0,type:"tinyint"},{name:"actionTypeID",required:!0,type:"tinyint"},{name:"text",required:!0,type:"string",maxLength:500},{name:"nextPageID",required:!0,type:"uint"},{name:"effectID",required:!1,type:"uint"},{name:"transitionID",required:!0,type:"tinyint"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.Actions=Backbone.Collection.extend({model:Adventure.ActionModel}),Adventure.ActionFlagRequirementModel=Backbone.Model.extend({defaults:{name:"",conditionID:1,flagID:0,counterValue:null,counterUpperValue:null,pageID:0,otherFlagID:0},idAttribute:"ID",initialize:function(){this.on("sync",this.updateName),this.form=this.attributes},updateName:function(){var e=int(this.get("flagID"))?Adventure.activeAdventure.get("flags").get(this.get("flagID")).get("name"):"New Requirement",t=int(this.get("otherFlagID"))?Adventure.activeAdventure.get("flags").get(this.get("otherFlagID")).get("name"):"",i=e;switch(int(this.get("conditionID"))){case 1:i="Always Trigger";break;case 2:i=e+" Active";break;case 3:i=e+" Inactive";break;case 4:i=e+" = "+(t?t:this.get("counterValue"));break;case 5:i=e+" != "+(t?t:this.get("counterValue"));break;case 6:i=e+" < "+(t?t:this.get("counterValue"));break;case 7:i=e+" <= "+(t?t:this.get("counterValue"));break;case 8:i=e+" > "+(t?t:this.get("counterValue"));break;case 9:i=e+" >= "+(t?t:this.get("counterValue"));break;case 10:i=e+" between "+this.get("counterValue")+" and "+this.get("counterUpperValue");break;case 11:i=e+" not between "+this.get("counterValue")+" and "+this.get("counterUpperValue");break;case 12:i=this.get("counterValue")+"% chance";break;case 13:i="Page = "+Adventure.activeAdventure.get("pages").get(this.get("pageID")).get("name");break;case 14:i="Page != "+Adventure.activeAdventure.get("pages").get(this.get("pageID")).get("name")}this.set("name",i)},urlRoot:"services/actionFlagRequirement.php",validate:function(){var e=int(this.form.find("[name='conditionID']").val())>1&&int(this.form.find("[name='conditionID']").val())<11,t=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesCounter")),i=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesRange")),n=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesPage")),r=validate(this.form,[{name:"conditionID",required:!0,type:"tinyint"},{name:"flagID",required:e,type:"uint"},{name:"counterValue",required:t,type:"int"},{name:"counterUpperValue",required:i,type:"int"},{name:"pageID",required:n,type:"uint"},{name:"otherFlagID",required:t&&!i,type:"uint"}]);return r.error?(Adventure.handleInvalidInput(r),r):void 0}}),Adventure.ActionFlagRequirements=Backbone.Collection.extend({model:Adventure.ActionFlagRequirementModel}),Adventure.SceneModel=Backbone.Model.extend({defaults:{name:"",actions:[],sceneEvents:[],pages:[]},idAttribute:"ID",initialize:function(){this.initSubItems(),this.form=this.attributes,this.handleBlankName(),this.on("sync",this.handleBlankName)},initSubItems:function(){Array.isArray(this.get("actions"))&&this.set("actions",new Adventure.Actions(this.get("actions"))),Array.isArray(this.get("sceneEvents"))&&this.set("sceneEvents",new Adventure.SceneEvents(this.get("sceneEvents")))},handleBlankName:function(){this.get("name")||this.set("name","(New scene #"+this.id+")")},urlRoot:"services/scene.php",validate:function(){var e=validate(this.form,[{name:"name",required:!0,type:"string",maxLength:50}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0},setSceneID:function(e){e.set("sceneID",this.ID)},buildPageCollection:function(){if(Array.isArray(this.get("pages"))&&this.set("pages",new Adventure.Pages(this.get("pages"))),Adventure.activeAdventure){var e=this;Adventure.activeAdventure.get("pages").each(function(t){t.get("sceneID")==e.id?e.get("pages").add(t):e.get("pages").get(t.id)&&e.get("pages").remove(t.id)})}}}),Adventure.Scenes=Backbone.Collection.extend({model:Adventure.SceneModel}),Adventure.FlagModel=Backbone.Model.extend({defaults:{name:"",isItem:0,description:"",imageID:null,isCounter:0,counterDefault:null,counterMinimum:null,counterMaximum:null,counterWraps:0},idAttribute:"ID",urlRoot:"services/flag.php",initialize:function(){this.handleBlankName(),this.on("sync",this.handleBlankName)},handleBlankName:function(){this.get("name")||this.set("name","(New flag #"+this.id+")")},validate:function(){var e=validate(this.form,[{name:"name",required:!0,type:"string",maxLength:50},{name:"isItem",required:!0,type:"bit"},{name:"description",required:!1,type:"string",maxLength:200},{name:"imageID",required:!1,type:"uint"},{name:"isCounter",required:!0,type:"bit"},{name:"counterDefault",required:!1,type:"int"},{name:"counterMinimum",required:!1,type:"int"},{name:"counterMaximum",required:!1,type:"int"},{name:"counterWraps",required:!0,type:"bit"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.Flags=Backbone.Collection.extend({model:Adventure.FlagModel}),Adventure.ImageModel=Backbone.Model.extend({defaults:{URL:"",width:0,height:0,centerX:"50%",centerY:"50%",scale:"1"},idAttribute:"ID",urlRoot:"services/image.php",validate:function(){var e=validate(this.form,[{name:"centerX",required:!0,type:"percent",maxLength:10},{name:"centerY",required:!0,type:"percent",maxLength:10},{name:"scale",required:!0,type:"decimal",maxLength:10}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0},applyAdjustment:function(e){e.css("transform","translateX(-"+this.get("centerX")+") translateY(-"+this.get("centerY")+") scale("+this.get("scale")+")"),e.css("-webkit-transform","translateX(-"+this.get("centerX")+") translateY(-"+this.get("centerY")+") scale("+this.get("scale")+")"),e.css("-ms-transform","translateX(-"+this.get("centerX")+") translateY(-"+this.get("centerY")+") scale("+this.get("scale")+")")}}),Adventure.Images=Backbone.Collection.extend({model:Adventure.ImageModel}),Adventure.EffectModel=Backbone.Model.extend({defaults:{name:"",keyframes:"",timing:"linear",duration:1,delay:0,loops:0,direction:"normal",fillMode:"none"},idAttribute:"ID",urlRoot:"services/effect.php",initialize:function(){this.handleBlankName(),this.on("sync",this.handleBlankName)},handleBlankName:function(){this.get("name")||this.set("name","(New effect #"+this.id+")")},validate:function(){var e=validate(this.form,[{name:"name",required:!0,type:"string",maxLength:50},{name:"keyframes",required:!0,type:"string",maxLength:1e3},{name:"timing",required:!0,type:"string",maxLength:40},{name:"duration",required:!0,type:"decimal",maxLength:10},{name:"delay",required:!0,type:"tinyint"},{name:"loops",required:!0,type:"tinyint"},{name:"direction",required:!0,type:"string",maxLength:20},{name:"fillMode",required:!0,type:"string",maxLength:20}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0},applyEffect:function(e){var t="effect-"+this.id+" "+this.get("timing")+" "+this.get("duration")+"s "+this.get("delay")+"s "+("0"==this.get("loops")?"infinite":this.get("loops"))+" "+this.get("direction")+" "+this.get("fillMode");e.css("animation","none"),e.css("-webkit-animation","none"),setTimeout(function(){e.css("animation",t),e.css("-webkit-animation",t)},20)}}),Adventure.Effects=Backbone.Collection.extend({model:Adventure.EffectModel,assembleKeyframes:function(){var e='<style type="text/css">\n',t="";for(var i in this.models)t=Adventure.addCSSSupport(this.models[i].get("keyframes")),e+="@keyframes effect-"+this.models[i].id+"{\n"+t+"\n}\n ",e+="@-webkit-keyframes effect-"+this.models[i].id+"{\n"+t+"\n}\n";return e+="</style>"}}),Adventure.EventModel=Backbone.Model.extend({defaults:{name:"(New Event)",eventTypeID:1,flagID:0,value:null,textBefore:"",textAfter:"",pageID:0,conditionID:1,counterValue:null,counterUpperValue:null,conditionFlagID:0,conditionPageID:0,conditionOtherFlagID:0},idAttribute:"ID",initialize:function(){this.updateName(),this.on("sync",this.updateName)},updateName:function(){var e=0==this.get("flagID")?"(Undefined)":Adventure.activeAdventure.get("flags").get(this.get("flagID")).get("name"),t=0==this.get("pageID")?"(Undefined)":Adventure.activeAdventure.get("pages").get(this.get("pageID")).get("name"),i="(New Event)";switch(int(this.get("eventTypeID"))){case 1:i="Display Text: ",this.get("textBefore")&&this.get("textAfter")?i+='"'+this.get("textBefore").substring(0,15)+(this.get("textBefore").length>15?"...":"")+'" / "'+this.get("textAfter").substring(0,15)+(this.get("textAfter").length>15?"...":"")+'"':this.get("textBefore")?i+='"'+this.get("textBefore").substring(0,15)+(this.get("textBefore").length>15?"...":"")+'"':this.get("textAfter")?i+='"'+this.get("textAfter").substring(0,15)+(this.get("textAfter").length>15?"...":"")+'"':i="(Undefined Event)";break;case 2:i="Set Flag: "+e;break;case 3:i="Remove Flag: "+e;break;case 4:i="Set "+e+" to "+this.get("value");break;case 5:i="Increase "+e+" by "+this.get("value");break;case 6:i="Jump to Page: "+t;break;case 7:i="Store Current Page";break;case 8:i="Jump to Stored Page";break;case 9:i="Stop Executing Events"}if(int(this.get("conditionID"))>1){e=0==this.get("conditionFlagID")?"(Undefined)":Adventure.activeAdventure.get("flags").get(this.get("conditionFlagID")).get("name");var n=int(this.get("conditionOtherFlagID"))?Adventure.activeAdventure.get("flags").get(this.get("conditionOtherFlagID")).get("name"):"";switch(i+=" if ",int(this.get("conditionID"))){case 2:i+=e+" Active";break;case 3:i+=e+" Inactive";break;case 4:i+=e+" = "+(n?n:this.get("counterValue"));break;case 5:i+=e+" != "+(n?n:this.get("counterValue"));break;case 6:i+=e+" < "+(n?n:this.get("counterValue"));break;case 7:i+=e+" <= "+(n?n:this.get("counterValue"));break;case 8:i+=e+" > "+(n?n:this.get("counterValue"));break;case 9:i+=e+" >= "+(n?n:this.get("counterValue"));break;case 10:i+=e+" between "+this.get("counterValue")+" and "+this.get("counterUpperValue");break;case 11:i+=e+" not between "+this.get("counterValue")+" and "+this.get("counterUpperValue");break;case 12:i+="Random number between "+this.get("counterValue")+" and "+this.get("counterUpperValue");break;case 13:i+="Page = "+Adventure.activeAdventure.get("pages").get(this.get("conditionPageID")).get("name");break;case 14:i+="Page != "+Adventure.activeAdventure.get("pages").get(this.get("conditionPageID")).get("name")}}this.set("name",i)},urlRoot:"services/event.php",validate:function(){var e=int(Adventure.eventTypes.get(this.form.find("[name='eventTypeID']").val()).get("involvesFlag")),t=int(Adventure.eventTypes.get(this.form.find("[name='eventTypeID']").val()).get("involvesValue")),i=int(Adventure.eventTypes.get(this.form.find("[name='eventTypeID']").val()).get("involvesPage")),n=int(this.form.find("[name='conditionID']").val())>1&&int(this.form.find("[name='conditionID']").val())<11,r=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesCounter")),s=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesRange")),a=int(Adventure.conditions.get(this.form.find("[name='conditionID']").val()).get("involvesPage")),o=validate(this.form,[{name:"eventTypeID",required:!0,type:"tinyint"},{name:"flagID",required:e,type:"uint"},{name:"value",required:t,type:"int"},{name:"textBefore",required:!1,type:"string",maxLength:200},{name:"textAfter",required:!1,type:"string",maxLength:200},{name:"pageID",required:i,type:"uint"},{name:"conditionID",required:!0,type:"tinyint"},{name:"conditionFlagID",required:n,type:"uint"},{name:"counterValue",required:r,type:"int"},{name:"counterUpperValue",required:s,type:"int"},{name:"conditionPageID",required:a,type:"uint"},{name:"conditionOtherFlagID",required:r&&!s,type:"uint"}]);return o.error?(Adventure.handleInvalidInput(o),o):void 0}}),Adventure.Events=Backbone.Collection.extend({model:Adventure.EventModel}),Adventure.SceneEventModel=Backbone.Model.extend({defaults:{name:"",eventID:0,priority:0},idAttribute:"ID",initialize:function(){this.on("sync",this.updateName)},updateName:function(){int(this.get("eventID"))>0?this.set("name",this.get("priority")+": "+Adventure.activeAdventure.get("events").get(this.get("eventID")).get("name")):this.set("name","(Undefined event)")},urlRoot:"services/sceneEvent.php",validate:function(){var e=validate(this.form,[{name:"eventID",required:!0,type:"uint"},{name:"priority",required:!0,type:"tinyint"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.SceneEvents=Backbone.Collection.extend({model:Adventure.SceneEventModel,comparator:function(e){return int(e.get("priority"))}}),Adventure.PageEventModel=Backbone.Model.extend({defaults:{name:"",eventID:0,priority:0},idAttribute:"ID",initialize:function(){this.on("sync",this.updateName)},updateName:function(){int(this.get("eventID"))>0?this.set("name",this.get("priority")+": "+Adventure.activeAdventure.get("events").get(this.get("eventID")).get("name")):this.set("name","(Undefined event)")},urlRoot:"services/pageEvent.php",validate:function(){var e=validate(this.form,[{name:"eventID",required:!0,type:"uint"},{name:"priority",required:!0,type:"tinyint"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.PageEvents=Backbone.Collection.extend({model:Adventure.PageEventModel,comparator:function(e){return int(e.get("priority"))}}),Adventure.ActionEventModel=Backbone.Model.extend({defaults:{name:"",eventID:0,priority:0},idAttribute:"ID",initialize:function(){this.on("sync",this.updateName)},updateName:function(){int(this.get("eventID"))>0?this.set("name",this.get("priority")+": "+Adventure.activeAdventure.get("events").get(this.get("eventID")).get("name")):this.set("name","(Undefined event)")},urlRoot:"services/actionEvent.php",validate:function(){var e=validate(this.form,[{name:"eventID",required:!0,type:"uint"},{name:"priority",required:!0,type:"tinyint"}]);return e.error?(Adventure.handleInvalidInput(e),e):void 0}}),Adventure.ActionEvents=Backbone.Collection.extend({model:Adventure.ActionEventModel,comparator:function(e){return int(e.get("priority"))}}),Adventure.PageTypeModel=Backbone.Model.extend({defaults:{name:"",style:""},idAttribute:"ID"}),Adventure.PageTypes=Backbone.Collection.extend({model:Adventure.PageTypeModel}),Adventure.TransitionModel=Backbone.Model.extend({defaults:{name:""},idAttribute:"ID"}),Adventure.Transitions=Backbone.Collection.extend({model:Adventure.TransitionModel}),Adventure.ConditionModel=Backbone.Model.extend({defaults:{name:"",involvesFlag:0,involvesCounter:0,involvesRange:0,involvesPage:0},idAttribute:"ID",evaluateCondition:function(e,t,i,n,r,s,a){switch(t=int(t),i=int(i),n=n||0,r=int(r)||0,s=int(s)||0,int(this.id)){case 2:return 1==e;case 3:return 0==e;case 4:return e==(void 0!==a&&null!==a?a:t);case 5:return e!=(void 0!==a&&null!==a?a:t);case 6:return(void 0!==a&&null!==a?a:t)>e;case 7:return(void 0!==a&&null!==a?a:t)>=e;case 8:return e>(void 0!==a&&null!==a?a:t);case 9:return e>=(void 0!==a&&null!==a?a:t);case 10:return e>=t&&i>=e;case 11:return!(e>=t&&i>=e);case 12:return n>=t&&i>=n;case 13:return s==r;case 14:return s!=r;default:return!0}}}),Adventure.Conditions=Backbone.Collection.extend({model:Adventure.ConditionModel}),Adventure.EventTypeModel=Backbone.Model.extend({defaults:{name:"",involvesFlag:0,involvesValue:0,involvesPage:0},idAttribute:"ID"}),Adventure.EventTypes=Backbone.Collection.extend({model:Adventure.EventTypeModel}),Adventure.ActionTypeModel=Backbone.Model.extend({defaults:{name:"",requiresText:0},idAttribute:"ID"}),Adventure.ActionTypes=Backbone.Collection.extend({model:Adventure.ActionTypeModel}),Adventure.initStatic=function(e){$.ajax({type:"POST",url:Adventure.assetPath+"services/static.php",success:function(t){Adventure.pageTypes=new Adventure.PageTypes(t.pageTypes),Adventure.transitions=new Adventure.Transitions(t.transitions),Adventure.conditions=new Adventure.Conditions(t.conditions),Adventure.eventTypes=new Adventure.EventTypes(t.eventTypes),Adventure.actionTypes=new Adventure.ActionTypes(t.actionTypes),e()},dataType:"json"}).fail(function(){alert("An error occurred while retrieving static data.")})},Adventure.Viewer=Marionette.LayoutView.extend({el:"#adventure",template:"Viewer",currentPageType:"normal",startingPage:0,transitionData:{},side:"A",otherSide:"B",blankHeight:0,regions:{imageA:".image-container.page-A",imageB:".image-container.page-B",pageA:".page-body.page-A",pageB:".page-body.page-B",inventory:".inventory-container",actionsA:".actions.page-A",actionsB:".actions.page-B"},ui:{closeBox:".adventure-background .close-box",overlay:".overlay",closeYes:".close-dialog .option-yes",closeNo:".close-dialog .option-no"},initialize:function(){var e=this;Adventure.initStatic(function(){e.setup()})},setup:function(){this.model=new Adventure.AdventureViewingModel({hashKey:this.$el.attr("data-adventure")}),this.variables={flags:[]},this.inventorySet=new Adventure.Flags,this.listenTo(this.model,"sync",function(){this.resetVariables(),this.resetTransitionData(),this.$el.prepend(this.model.get("effects").assembleKeyframes()),this.transitionData.nextPageID=this.variables.startingPage,this.loadPage(),this.resetTransitionData(),this.$el.find(".image-manager .page-"+this.otherSide).hide(),this.$el.find(".action-manager .page-"+this.otherSide).hide(),this.$el.find(".page-manager").height(this.$el.find(".page-manager .page-"+this.side).innerHeight()),this.$el.find(".action-manager").height(this.$el.find(".action-manager .page-"+this.side).outerHeight(!0)),this.trimActions(),this.resizeBox()});var e=this;$(window).on("resize",function(){e.resizeBox()}),this.render()},onRender:function(){this.showChildView("inventory",new Adventure.Inventory({collection:this.inventorySet})),this.$el.find(".adventure-background-transition").hide(),this.$el.find(".adventure-box").css("top",$(window).scrollTop()+48+"px"),this.resizeBox()},events:{"click @ui.closeBox":function(){this.$el.find(".close-dialog").show()},"dblclick @ui.overlay":function(){this.$el.find(".close-dialog").show()},"click @ui.closeYes":function(){this.$el.find(".close-dialog").hide(),this.$el.find(".adventure-container").addClass("closing"),_.delay(function(e){e.destroy()},1e3,this)},"click @ui.closeNo":function(){this.$el.find(".close-dialog").hide()}},resetVariables:function(){var e=this;this.variables.startingPage=this.model.get("pages").models[0].id,this.variables.currentPage=0,this.variables.checkpointPage=0,this.variables.storedPage=0,this.model.get("flags").each(function(t){e.variables.flags[int(t.id)]=int(t.get("isCounter"))?int(t.get("counterDefault"))||0:0,int(t.get("isItem"))&&e.inventorySet.add(t)}),this.savedVariables=JSON.parse(JSON.stringify(this.variables))},resetTransitionData:function(){this.transitionData.transitioning=!1,this.transitionData.nextPageID=0,this.transitionData.nextPageClass="normal",this.transitionData.effectID=0,this.transitionData.transitionID=1,this.transitionData.beforePageText="",this.transitionData.afterPageText="",this.transitionData.randomRoll=0},beginTransition:function(){if(this.resizeBox(),this.transitionData.effectID>0){var e=this.model.get("effects").get(this.transitionData.effectID);e?(e.applyEffect(this.$el.find(".image-manager .page-"+this.side+" img")),_.delay(function(e){e.$el.find(".image-manager .page-"+e.side+" img").css("animation","initial"),e.handleTransition()},e.get("duration")*e.get("loops")*1e3,this)):this.handleTransition()}else this.handleTransition()},handleTransition:function(){var e=this;switch(this.transitionData.transitioning=!0,this.otherSide=this.side,this.side="A"==this.side?"B":"A",0==this.transitionData.nextPageID&&(this.transitionData.nextPageID=this.variables.currentPage),this.loadPage(),this.backgroundTransition(this.transitionData.nextPageClass),int(this.transitionData.transitionID)){case 1:this.$el.find(".image-manager .page-"+this.otherSide).css("z-index",1),this.$el.find(".image-manager .page-"+this.side).css("z-index",2).fadeIn(1e3,function(){e.$el.find(".image-manager .page-"+e.otherSide).hide()});break;case 2:this.$el.find(".image-manager .page-"+this.side).show(),this.$el.find(".image-manager .page-"+this.otherSide).hide();break;case 3:this.$el.find(".image-manager .blank").addClass("black").fadeIn(500,function(){e.$el.find(".image-manager .page-"+e.side).show(),e.$el.find(".image-manager .page-"+e.otherSide).hide(),e.$el.find(".image-manager .blank").fadeOut(500,function(){$(this).removeClass("black")})});break;case 4:this.$el.find(".image-manager .blank").addClass("white").fadeIn(500,function(){e.$el.find(".image-manager .page-"+e.side).show(),e.$el.find(".image-manager .page-"+e.otherSide).hide(),e.$el.find(".image-manager .blank").fadeOut(500,function(){$(this).removeClass("white")})});break;case 5:this.$el.find(".image-manager .page-"+this.side).show(),this.$el.find(".image-manager .page-"+this.side+" div").css("left","-100%").animate({left:"0%"},1e3),this.$el.find(".image-manager .page-"+this.otherSide+" div").animate({left:"100%"},1e3,function(){$(this).css("left","0%"),e.$el.find(".image-manager .page-"+e.otherSide).hide()});break;case 6:this.$el.find(".image-manager .page-"+this.side).show(),this.$el.find(".image-manager .page-"+this.side+" div").css("left","100%").animate({left:"0%"},1e3),this.$el.find(".image-manager .page-"+this.otherSide+" div").animate({left:"-100%"},1e3,function(){$(this).css("left","0%"),e.$el.find(".image-manager .page-"+e.otherSide).hide()});break;case 7:this.$el.find(".image-manager .page-"+this.side).show(),this.$el.find(".image-manager .page-"+this.side+" div").css("top","-100%").animate({top:"0%"},1e3),this.$el.find(".image-manager .page-"+this.otherSide+" div").animate({top:"100%"},1e3,function(){$(this).css("top","0%"),e.$el.find(".image-manager .page-"+e.otherSide).hide()
});break;case 8:this.$el.find(".image-manager .page-"+this.side).show(),this.$el.find(".image-manager .page-"+this.side+" div").css("top","100%").animate({top:"0%"},1e3),this.$el.find(".image-manager .page-"+this.otherSide+" div").animate({top:"-100%"},1e3,function(){$(this).css("top","0%"),e.$el.find(".image-manager .page-"+e.otherSide).hide()})}this.$el.find(".page-manager .page-"+this.side).css("top","100%").css("bottom",""),this.$el.find(".page-manager").animate({height:this.$el.find(".page-manager .page-"+this.side).innerHeight()+"px"},1e3),this.$el.find(".page-manager .page-"+this.side).animate({top:"0%"},1e3),this.$el.find(".page-manager .page-"+this.otherSide).css("top","").animate({bottom:"100%"},1e3),this.$el.find(".action-manager .page-"+this.side).show().css("left","100%").fadeOut(750,function(){e.$el.find(".action-manager .page-"+e.side).css("left","0%").fadeIn(250)}),_.delay(function(e){e.trimActions()},751,this),this.$el.find(".action-manager .page-"+this.otherSide).fadeOut(250),this.$el.find(".action-manager").animate({height:this.$el.find(".action-manager .page-"+this.side).outerHeight(!0)+"px"},1e3,function(){e.resetTransitionData(),e.$el.find(".adventure-manager").removeClass("transitioning")});var t=this.blankHeight+this.$el.find(".image-manager .page-"+this.side).innerHeight()+this.$el.find(".page-manager .page-"+this.side).innerHeight()+this.$el.find(".action-manager .page-"+this.side).outerHeight(!0)+this.$el.find(".inventory-container").outerHeight(!0);t%16>0&&(t+=16-t%16),this.$el.find(".adventure-box").animate({height:t+"px"}),this.$el.find(".adventure-manager").addClass("transitioning").animate({height:t-16+"px"}),$("html, body").animate({scrollTop:this.$el.find(".adventure-box").offset().top},500)},loadPage:function(){return this.variables.currentPage=this.transitionData.nextPageID,pageModel=this.model.get("pages").get(this.transitionData.nextPageID),sceneModel=this.model.get("scenes").get(pageModel.get("sceneID")),sceneModel&&(pageModel.get("actions").add(sceneModel.get("actions").toJSON()),sceneModel.get("sceneEvents").each(function(e){pageModel.get("pageEvents").add({ID:"s_"+e.id,priority:e.get("priority"),eventID:e.get("eventID")})})),this.handleEvents(pageModel.get("pageEvents")),this.transitionData.nextPageID!=this.variables.currentPage?(this.loadPage(),!1):(this.transitionData.nextPageClass=Adventure.pageTypes.get(pageModel.get("pageTypeID")).get("style"),"checkpoint"==this.transitionData.nextPageClass&&(this.variables.checkpointPage=this.transitionData.nextPageID,this.savedVariables=JSON.parse(JSON.stringify(this.variables)),this.transitionData.beforePageText=Adventure.Templates.Checkpoint+this.transitionData.beforePageText),("death"==this.transitionData.nextPageClass||"badEnding"==this.transitionData.nextPageClass||"goodEnding"==this.transitionData.nextPageClass)&&("goodEnding"!=this.transitionData.nextPageClass&&pageModel.get("actions").add({ID:"checkpoint",text:"Return to Checkpoint"}),pageModel.get("actions").add({ID:"restart",text:"Restart"})),this.showChildView("image"+this.side,new Adventure.ViewerImage({model:this.model.get("images").get(pageModel.get("imageID")),effect:this.model.get("effects").get(pageModel.get("effectID"))})),this.showChildView("page"+this.side,new Adventure.ViewerPage({model:pageModel,beforeText:this.transitionData.beforePageText,afterText:this.transitionData.afterPageText})),void this.showChildView("actions"+this.side,new Adventure.ViewerActionList({collection:pageModel.get("actions")})))},backgroundTransition:function(e){if(this.currentPageType!=e){var t=this;this.$el.find(".adventure-background-transition").addClass(e),this.$el.find(".adventure-background-transition").fadeIn(1e3,function(){t.$el.find(".adventure-background").removeClass(t.currentPageType),t.$el.find(".adventure-background").addClass(e),t.$el.find(".adventure-background-transition").removeClass(e),t.$el.find(".adventure-background-transition").hide(),t.currentPageType=e})}},performAction:function(e){this.transitionData.transitioning||(this.transitionData.randomRoll=Math.floor(101*Math.random()),e.get("actionEvents").length&&this.handleEvents(e.get("actionEvents")),int(e.get("nextPageID"))>0&&!this.transitionData.nextPageID&&(this.transitionData.nextPageID=e.get("nextPageID")),int(e.get("effectID"))>0&&(this.transitionData.effectID=e.get("effectID")),int(e.get("transitionID"))>0&&(this.transitionData.transitionID=e.get("transitionID")),this.beginTransition())},restart:function(){this.resetVariables(),this.transitionData.nextPageID=this.variables.startingPage,this.transitionData.transitionID=3,this.transitionData.randomRoll=Math.floor(101*Math.random()),this.beginTransition()},returnToCheckpoint:function(){this.variables=JSON.parse(JSON.stringify(this.savedVariables)),this.transitionData.nextPageID=this.variables.checkpointPage,this.transitionData.transitionID=3,this.transitionData.randomRoll=Math.floor(101*Math.random()),this.beginTransition()},handleEvents:function(e){var t=this;e.every(function(e){var i=t.model.get("events").get(e.get("eventID"));if(Adventure.conditions.get(i.get("conditionID")).evaluateCondition(t.variables.flags[int(i.get("conditionFlagID"))]||0,i.get("counterValue"),i.get("counterUpperValue"),t.transitionData.randomRoll,t.variables.currentPage,i.get("conditionPageID"),t.variables.flags[int(i.get("conditionOtherFlagID"))])){switch(""!=i.get("textBefore")&&(t.transitionData.beforePageText+=i.get("textBefore")+"<br><br>"),""!=i.get("textAfter")&&(t.transitionData.afterPageText+="<br><br>"+i.get("textAfter")),int(i.get("eventTypeID"))){case 2:t.variables.flags[int(i.get("flagID"))]=1;break;case 3:t.variables.flags[int(i.get("flagID"))]=0;break;case 4:t.variables.flags[int(i.get("flagID"))]=int(i.get("value"));break;case 5:t.variables.flags[int(i.get("flagID"))]+=int(i.get("value"));break;case 6:return t.transitionData.nextPageID=i.get("pageID"),!1;case 7:t.variables.storedPage=t.variables.currentPage;break;case 8:t.transitionData.nextPageID||(t.transitionData.nextPageID=t.variables.storedPage);break;case 9:return!1}if(int(i.get("flagID"))&&int(t.model.get("flags").get(i.get("flagID")).get("isCounter"))){var n=null!=t.model.get("flags").get(i.get("flagID")).get("counterMinimum")?int(t.model.get("flags").get(i.get("flagID")).get("counterMinimum")):null,r=null!=t.model.get("flags").get(i.get("flagID")).get("counterMaximum")?int(t.model.get("flags").get(i.get("flagID")).get("counterMaximum")):null;if(int(t.model.get("flags").get(i.get("flagID")).get("counterWraps"))&&null!=n&&null!=r){for(;t.variables.flags[int(i.get("flagID"))]<n;)t.variables.flags[int(i.get("flagID"))]+=r-n+1;for(;t.variables.flags[int(i.get("flagID"))]>r;)t.variables.flags[int(i.get("flagID"))]-=r-n+1}else null!=n&&t.variables.flags[int(i.get("flagID"))]<n?t.variables.flags[int(i.get("flagID"))]=n:null!=r&&t.variables.flags[int(i.get("flagID"))]>r&&(t.variables.flags[int(i.get("flagID"))]=r)}}return!0}),this.inventorySet.trigger("change")},trimActions:function(){this.$el.find(".action-manager .page-"+this.side+" .selection > div").each(function(){$(this).find("p").length&&($(this).css("width","100%"),$(this).css("width",Math.min($(this).find("p").outerWidth()+27,$(this).outerWidth())+"px"))})},resizeBox:function(){var e=Math.min($(".adventure-container").width(),640);$(".adventure-box").width(Math.max(e-e%16,160)),this.$el.find(".page-manager").height(this.$el.find(".page-manager .page-"+this.side).innerHeight()),this.$el.find(".action-manager").height(this.$el.find(".action-manager .page-"+this.side).outerHeight(!0));var t=$(".adventure-content").innerHeight();$(".adventure-box").height(t%16>0?t+16-t%16:t),this.blankHeight=this.$el.find(".adventure-box").height()-this.$el.find(".image-manager .page-"+this.side).innerHeight()-this.$el.find(".page-manager .page-"+this.side).innerHeight()-this.$el.find(".action-manager .page-"+this.side).outerHeight(!0)-this.$el.find(".inventory-container").outerHeight(!0),this.trimActions()},onDestroy:function(){$(window).off("resize load",this.resizeBox)}}),Adventure.ViewerImage=Marionette.ItemView.extend({template:"ViewerImage",onRender:function(){this.$el.find("img").attr("src",Adventure.assetPath+"uploads/"+this.model.get("URL")),this.$el.find("img").css("transform","translateX(-"+this.model.get("centerX")+") translateY(-"+this.model.get("centerY")+") scale("+this.model.get("scale")+")"),this.$el.find("img").css("-webkit-transform","translateX(-"+this.model.get("centerX")+") translateY(-"+this.model.get("centerY")+") scale("+this.model.get("scale")+")"),this.$el.find("img").css("-ms-transform","translateX(-"+this.model.get("centerX")+") translateY(-"+this.model.get("centerY")+") scale("+this.model.get("scale")+")"),this.getOption("effect")&&this.getOption("effect").applyEffect(this.$el.find("img"))}}),Adventure.ViewerPage=Marionette.ItemView.extend({template:"ViewerPage",initialize:function(e){this.model.set("combinedText",e.beforeText+this.model.get("filteredText")+e.afterText)}}),Adventure.ViewerActionButton=Marionette.ItemView.extend({template:"ViewerActionButton",className:"selection",events:{click:function(e){switch(e.preventDefault(),this.model.id){case"restart":Adventure.viewer.restart();break;case"checkpoint":Adventure.viewer.returnToCheckpoint();break;default:Adventure.viewer.performAction(this.model)}return!1}},modelEvents:{change:"render"}}),Adventure.ViewerActionList=Marionette.CollectionView.extend({className:"selection-list",childView:Adventure.ViewerActionButton,viewComparator:function(e){return int(e.get("priority"))},filter:function(e){var t=e.get("actionFlagRequirements"),i=!0;return"checkpoint"==e.id&&0==Adventure.viewer.variables.checkpointPage&&(i=!1),t&&t.every(function(e){return Adventure.conditions.get(e.get("conditionID")).evaluateCondition(Adventure.viewer.variables.flags[int(e.get("flagID"))]||0,e.get("counterValue"),e.get("counterUpperValue"),Adventure.viewer.transitionData.randomRoll,Adventure.viewer.variables.currentPage,e.get("pageID"),Adventure.viewer.variables.flags[int(e.get("otherFlagID"))])?void 0:(i=!1,!1)}),i}}),Adventure.InventoryItem=Marionette.ItemView.extend({template:"InventoryItem",className:"item",ui:{description:".description"},onRender:function(){this.renderImage(),int(this.model.get("isCounter"))&&this.$el.find(".quantity").html(Adventure.viewer.variables.flags[this.model.id])},events:{mouseover:function(){if(this.$el.find(".description").css("left","50%"),$(".adventure-box").width()>312){var e=this.$el.offset().left-$(".adventure-box").offset().left,t=$(".adventure-box").width()-e-32;140>t?this.$el.find(".description").css("left",100-3.125*(156-t)+"%"):140>e&&this.$el.find(".description").css("left",3.125*(156-e)+"%")}}},modelEvents:{change:"render"},renderImage:function(){var e=Adventure.activeAdventure.get("images").get(this.model.get("imageID"));e?(this.$el.find("img").show().removeAttr("style").attr("src",Adventure.assetPath+"uploads/"+e.get("URL")),this.$el.find("img").css("transform","translateX(-"+e.get("centerX")+") translateY(-"+e.get("centerY")+") scale("+e.get("scale")+")"),this.$el.find("img").css("-webkit-transform","translateX(-"+e.get("centerX")+") translateY(-"+e.get("centerY")+") scale("+e.get("scale")+")"),this.$el.find("img").css("-ms-transform","translateX(-"+e.get("centerX")+") translateY(-"+e.get("centerY")+") scale("+e.get("scale")+")")):this.$el.find("img").hide()}}),Adventure.Inventory=Marionette.CollectionView.extend({className:"inventory",childView:Adventure.InventoryItem,filter:function(e){return Adventure.viewer.variables.flags[e.id]>0},onRender:function(){0==this.$el.find(".item").length?this.$el.hide():0==this.$el.find(":visible").length&&this.$el.fadeIn()},collectionEvents:{change:"render"}}),Adventure.Templates||(Adventure.Templates={}),Adventure.Templates.Viewer='<div class="adventure-container"><div class="overlay"></div><div class="adventure-box"><div class="adventure-manager"><div class="adventure-content"><div class="image-manager"><div class="image-container page-A"></div><div class="image-container page-B"></div><div class="image-container blank"></div></div><div class="page-manager"><div class="page-body page-A"></div><div class="page-body page-B"></div></div><div class="inventory-container"></div><div class="action-manager"><div class="actions page-A"></div><div class="actions page-B"></div></div></div></div><div class="adventure-background-transition"><div class="close-box"></div></div><div class="adventure-background normal"><div class="close-box"></div></div></div><div class="close-dialog">Are you sure you want to end your adventure? Your adventuring progress will be lost.<div class="dialog-button option-yes">Yes, I tire of adventuring.</div><div class="dialog-button option-no">No, I want to continue my adventure.</div></div></div>',Adventure.Templates.ViewerImage="<img />",Adventure.Templates.ViewerPage="<%= combinedText %>",Adventure.Templates.ViewerActionButton='<div class="<%= (actionTypeID == 2) ? "speech-bubble" : "action-box" %>"><% if (actionTypeID == 3 || actionTypeID == 4){ %><img src="<%= Adventure.assetPath + "img/viewer/" + (actionTypeID == 3 ? "forward" : "back") %>-arrow.gif" /><% }else{ %><p><%= text %></p><% } %></div>',Adventure.Templates.InventoryItem='<div class="item-image-container"><img /></div><div class="quantity"></div><div class="description"><div class="description-image-container"><div><img /></div></div><h3><%= name %></h3><p><%= description %></p></div>',Adventure.Templates.Checkpoint='<div class="checkpoint"><span>CHECKPOINT</span></div>';