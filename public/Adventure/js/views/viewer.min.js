Adventure.Viewer=Marionette.LayoutView.extend({el:"#adventure",template:"Viewer",currentPageType:"normal",startingPage:0,regions:{pageView:".adventure-content"},initialize:function(){this.model=new Adventure.AdventureViewingModel({hashKey:this.$el.attr("data-adventure")}),this.listenTo(this.model,"sync",function(){this.startingPage=this.model.get("pages").models[0].id,this.loadPage(this.startingPage)}),$(window).resize(this.resizeBox),$(window).load(this.resizeBox),this.render()},onRender:function(){var e=this;this.$el.find(".adventure-background-transition").hide(),this.resizeBox(),this.$el.find(".adventure-container").click(function(){e.backgroundTransition("goodEnding")})},loadPage:function(e){this.showChildView("pageView",new Adventure.ViewerPage({model:this.model.get("pages").get(e)}))},resizeBox:function(){var e=Math.min($(".adventure-container").width(),640);$(".adventure-box").width(Math.max(e-e%16,160));var t=$(".adventure-content").innerHeight();t%16>0&&$(".adventure-box").height(t+16-t%16),$(".image-container").height($(".adventure-box").width()>=640?350:58+292*($(".adventure-box").width()-160)/480)},backgroundTransition:function(e){var t=this;this.$el.find(".adventure-background-transition").addClass(e),this.$el.find(".adventure-background-transition").fadeIn(400,function(){t.$el.find(".adventure-background").removeClass(t.currentPageType),t.$el.find(".adventure-background").addClass(e),t.$el.find(".adventure-background-transition").removeClass(e),t.$el.find(".adventure-background-transition").hide(),t.currentPageType=e})}}),Adventure.ViewerPage=Marionette.LayoutView.extend({template:"ViewerPage",currentPageType:"normal",regions:{actionList:".actions"},onRender:function(){this.showChildView("actionList",new Adventure.ViewerActionList({collection:this.model.get("actions")}))}}),Adventure.ViewerActionButton=Marionette.ItemView.extend({template:"ViewerActionButton",className:"selection",initialize:function(){this.model;this.listenTo(this.model,"change",this.render),this.$el.click(function(){})}}),Adventure.ViewerActionList=Marionette.CollectionView.extend({className:"selection-list",childView:Adventure.ViewerActionButton});